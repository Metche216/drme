{% extends 'base_nf.html' %}

{% load static %}

{% block title %}Citas - Dr. MediCare{% endblock %}

{% block content %}

<style>
    .navbar {
        background-color: rgba(0, 0, 0, 0.5); /* Semi-transparent black */
        transition: background-color 0.3s ease;
    }

    .hero-section {
        background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('{% static "images/bg_turnos.jpg" %}');
        background-size: cover;
        background-position: center top -650px; /* Focus on the top-center part of the image */
        height: 250px; /* Reduced height for a more compact header */
        overflow: hidden;
    }

    .hero-section h1 {
        margin-bottom: 0.5rem;
    }

    .hero-section p.lead {
        margin-top: 1rem;
    }
</style>
<!-- Hero Section -->
<section class="hero-section d-flex align-items-center justify-content-center text-center text-white">
    <div class="container">
        <h1 class="display-4 fw-bold">Citas Médicas</h1>
        <p class="lead">Consulta tus citas anteriores y reserva nuevas citas fácilmente.</p>
    </div>
</section>

<section class="section">
    <div class="container">
        <h3 class="fw-bold">Próximas Citas</h3>
        <p id="loading-message">Cargando citas...</p>
        <ul id="appointments-list" class="list-group">
            <!-- Appointments will be dynamically populated here -->
        </ul>
    </div>
</section>

<script>
    document.addEventListener("DOMContentLoaded", async () => {
        const appointmentsList = document.getElementById("appointments-list");
        const loadingMessage = document.getElementById("loading-message");

        try {
            // Fetch appointments from the API
            const response = await fetch("/turnos/api/appointments/");
            if (!response.ok) {
                throw new Error("Error fetching appointments");
            }

            const data = await response.json();

            // Clear the loading message
            loadingMessage.style.display = "none";

            // Populate the appointments list
            if (data.appointments.length > 0) {
                data.appointments.forEach((appointment) => {
                    const listItem = document.createElement("li");
                    listItem.className = "list-group-item";
                    listItem.textContent = `${appointment.start}: ${appointment.summary}`;
                    appointmentsList.appendChild(listItem);
                });
            } else {
                const noAppointments = document.createElement("li");
                noAppointments.className = "list-group-item";
                noAppointments.textContent = "No hay citas próximas.";
                appointmentsList.appendChild(noAppointments);
            }
        } catch (error) {
            console.error("Error fetching appointments:", error);
            loadingMessage.textContent = "Error al cargar las citas.";
        }
    });
</script>
{% endblock %}